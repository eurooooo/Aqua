# AI饮食助手（Aqua）- 实施阶段规划

## 阶段概览

整个项目分为 **6 个主要阶段**，从基础设施搭建到完整MVP交付：

---

## 🔧 阶段一：项目初始化与基础设施搭建（1-2天）

### 目标
搭建前后端开发环境，配置基础架构

### 任务清单
1. **项目结构初始化**
   - 创建 `frontend/` 和 `backend/` 目录
   - 初始化 React + Vite + TypeScript 项目
   - 初始化 FastAPI 项目结构

2. **依赖安装**
   - 前端：React Router, Zustand, shadcn/ui, react-dropzone
   - 后端：FastAPI, SQLAlchemy, Pydantic, python-multipart

3. **开发环境配置**
   - 配置 Vite 开发服务器
   - 配置 FastAPI CORS
   - 设置环境变量文件 (`.env`)

4. **数据库初始化**
   - 配置 SQLite 数据库连接
   - 创建数据库初始化脚本

### 交付物
- ✅ 可运行的前端开发服务器（空白页面）
- ✅ 可运行的后端 API 服务器（健康检查端点）
- ✅ 数据库连接测试通过

---

## 📊 阶段二：数据库设计与用户档案功能（2-3天）

### 目标
实现用户信息管理功能（无登录系统，单用户）

### 任务清单
1. **数据库模型设计**
   - 创建 `User` 表（SQLAlchemy 模型）
   - 创建 `MealRecord` 表
   - 创建 `FoodItem` 表
   - 编写数据库迁移脚本

2. **后端 API 开发**
   - `POST /api/user/profile` - 创建/更新用户档案
   - `GET /api/user/profile` - 获取用户档案
   - 营养目标计算逻辑（基于年龄、性别、体重、活动水平）

3. **前端页面开发**
   - 用户档案表单页面（ProfilePage）
   - 表单验证（年龄、身高、体重范围）
   - 健康目标选择器
   - 饮食限制多选组件

4. **数据持久化**
   - Zustand store 管理用户信息
   - API 集成与状态同步

### 交付物
- ✅ 用户可以填写并保存个人档案
- ✅ 系统自动计算每日营养目标
- ✅ 数据库正确存储用户信息

---

## 📸 阶段三：AI图像识别与饮食记录（3-4天）

### 目标
实现拍照上传、AI识别食物、营养分析、饮食记录保存

### 任务清单
1. **Gemini API 集成**
   - 配置 Gemini 3 Pro API 密钥
   - 创建 `vision.py` 服务
   - 实现图像上传和识别接口
   - 设计 Prompt 模板（识别食物 + 营养成分分析）

2. **后端 API 开发**
   - `POST /api/meals/analyze-image` - 上传图片，返回识别结果
   - `POST /api/meals/record` - 保存饮食记录
   - `GET /api/meals/today` - 获取今日饮食记录
   - `GET /api/meals/history` - 获取历史记录（7天）

3. **前端功能开发**
   - 图片上传组件（拍照/选择图片）
   - AI 识别结果展示与编辑组件
   - 餐次选择器（早/午/晚/加餐）
   - 饮食记录列表页面

4. **数据结构优化**
   - FoodItem 数据验证（营养成分格式）
   - MealRecord 时间戳处理

### 交付物
- ✅ 用户可以上传食物图片
- ✅ AI 自动识别并分析营养成分
- ✅ 用户可以确认/修正识别结果
- ✅ 饮食记录成功保存到数据库

---

## 🤖 阶段四：AI推荐系统（3-4天）

### 目标
基于饮食历史和用户档案，生成下一餐推荐方案

### 任务清单
1. **推荐逻辑设计**
   - 创建 `recommendation.py` 服务
   - 设计推荐 Prompt 模板
   - 实现营养缺口计算逻辑
   - 生成多套方案（2-3套）

2. **后端 API 开发**
   - `POST /api/recommendations/generate` - 生成推荐
     - 输入：用户ID、餐次类型
     - 输出：多套 MealPlan 方案
   - `GET /api/recommendations/latest` - 获取最近推荐

3. **前端功能开发**
   - 推荐触发按钮（"AI推荐下一餐"）
   - 多套方案展示组件（卡片式布局）
   - 方案详情（菜品名称、食材、营养数据、推荐理由）
   - 重新生成推荐功能
   - 选择方案后的保存逻辑

4. **Gemini Prompt 优化**
   - 测试并优化推荐质量
   - 处理中文菜品名称
   - 确保输出格式符合 Pydantic 模型

### 交付物
- ✅ 用户可以获取AI推荐的下一餐方案
- ✅ 推荐考虑了用户目标、限制和当日营养缺口
- ✅ 用户可以选择喜欢的方案或重新生成

---

## 📈 阶段五：数据展示与核心交互优化（2-3天）

### 目标
实现营养摄入概览、进度条展示、页面导航

### 任务清单
1. **营养仪表盘开发**
   - 当日卡路里摄入 vs 目标（进度条）
   - 蛋白质/碳水/脂肪摄入对比
   - 已吃食物列表展示
   - 剩余营养配额计算

2. **页面路由设计**
   - 首页：营养仪表盘 + 快捷操作
   - 记录页面：拍照上传 + AI识别
   - 推荐页面：查看推荐方案
   - 档案页面：编辑用户信息

3. **UI/UX 优化**
   - 使用 shadcn/ui 组件库统一风格
   - 响应式设计（移动端优先）
   - 加载状态和错误提示
   - Toast 通知反馈

4. **数据同步优化**
   - 实时更新营养进度
   - 乐观更新（Optimistic UI）

### 交付物
- ✅ 清晰的营养摄入可视化界面
- ✅ 流畅的用户交互体验
- ✅ 完整的页面导航流程

---

## 🚀 阶段六：测试、优化与部署（2-3天）

### 目标
确保功能完整性，修复 Bug，部署到生产环境

### 任务清单
1. **功能测试**
   - 端到端测试（用户档案 → 记录 → 推荐）
   - 边界情况测试（空数据、错误图片、API失败）
   - 跨浏览器测试

2. **性能优化**
   - 图片压缩（上传前）
   - API 响应时间优化
   - 前端打包优化（代码分割）

3. **文档编写**
   - README.md（项目介绍、安装步骤）
   - API 文档（自动生成 FastAPI Swagger）
   - 环境变量配置说明

4. **部署配置**
   - 前端：Vercel 部署配置
   - 后端：Render/Railway 部署配置
   - 环境变量设置（生产环境）
   - PostgreSQL 数据库迁移（如需要）

5. **监控与日志**
   - 错误日志记录
   - API 调用监控

### 交付物
- ✅ 完整的 MVP 功能可用
- ✅ 前后端部署到生产环境
- ✅ 用户可以通过公网访问应用

---

## 📅 时间估算

| 阶段 | 预计时间 | 累计时间 |
|------|---------|---------|
| 阶段一 | 1-2天 | 1-2天 |
| 阶段二 | 2-3天 | 3-5天 |
| 阶段三 | 3-4天 | 6-9天 |
| 阶段四 | 3-4天 | 9-13天 |
| 阶段五 | 2-3天 | 11-16天 |
| 阶段六 | 2-3天 | 13-19天 |

**总计：约 2.5-4 周**（取决于每日开发时间投入）

---

## 🎯 成功标准（MVP验收）

- [ ] 用户可以创建个人档案并设置健康目标
- [ ] 用户可以通过拍照记录饮食，AI 自动识别食物和营养
- [ ] 系统根据用户历史和目标推荐下一餐（多套方案）
- [ ] 用户可以查看当日营养摄入进度
- [ ] 前后端部署到生产环境且稳定运行

---

## 💡 实施建议

1. **渐进式开发**：每完成一个阶段立即测试，避免积累问题
2. **API 优先**：先定义好后端 API 接口，前后端可并行开发
3. **Prompt 工程**：AI 识别和推荐的质量依赖 Prompt 设计，需要多次迭代优化
4. **移动端优先**：饮食记录场景多在移动端，确保手机端体验流畅

---

## 📝 相关文档

- [产品分析与MVP方案](PLAN.md)
- 前端文档：`frontend/README.md`（待创建）
- 后端文档：`backend/README.md`（待创建）
- API 文档：`http://localhost:8000/docs`（开发环境）
